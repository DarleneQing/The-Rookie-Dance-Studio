# Context
File name: 2025-12-14_2_db_schema.md
Created at: 2025-12-14
Created by: Assistant
Main branch: main
Task Branch: task/db-schema_2025-12-14_2
Yolo Mode: Off

# Task Description
Design and create the SQL schema for the Dance Group Check-in System.
Requirements from spec:
- Users (Register/Login, Google Auth, Profile Pic)
- Roles (Admin vs User)
- Subscriptions (Monthly, 5-times, 10-times)
- Check-ins (History, count deduction)
- Logic for validity (30 days for monthly, >0 count for packs)

# Project Overview
Supabase-backed application. Need to define Tables, RLS policies, and potentially Triggers/Functions.

⚠️ WARNING: NEVER MODIFY THIS SECTION ⚠️
1.  **Stop and Think**: Always pause to analyze before acting.
2.  **Mode Declaration**: Start every response with the current mode (e.g., [MODE: RESEARCH]).
3.  **Task File Management**: Create and maintain a task file for every task.
4.  **Protocol Adherence**: Follow the defined steps for each mode (Research -> Innovate -> Plan -> Execute -> Review).
5.  **Code References**: Use correct citation format for existing code.
⚠️ WARNING: NEVER MODIFY THIS SECTION ⚠️

# Analysis
Entities needed:
1. `profiles` (extends auth.users):
   - id (references auth.users)
   - full_name
   - avatar_url
   - role (user/admin)
   - created_at

2. `subscriptions` (User's active plan):
   - id
   - user_id
   - type (monthly, 5_times, 10_times)
   - start_date (for monthly)
   - end_date (for monthly)
   - total_credits (5 or 10, null for monthly)
   - remaining_credits (for times card)
   - is_active (boolean)

3. `checkins`:
   - id
   - user_id
   - checkin_time
   - admin_id (who scanned)
   - subscription_id (which sub was used)

Need RLS policies:
- Users can read their own profile and sub.
- Admins can read/write all.

# Proposed Solution
Create a `schema.sql` file in `supabase/` folder (or `docs/`) to be executed in Supabase SQL editor.

# Current execution step: "Done"

# Task Progress
[2025-12-14]
- Task file created.
- Schema designed and written to `docs/schema.sql`.
- Included Tables: profiles, subscriptions, checkins.
- Included Enums: user_role, subscription_type, etc.
- Included RLS Policies.
- Included Functions: `assign_subscription`, `perform_checkin`.

# Final Review:
Schema is complete and matches spec requirements.
Status: Completed
